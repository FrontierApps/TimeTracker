<% if current_user.admin? %>
<% @user = @timerecord.first %>
<% if @user == nil%>
 <h2> There are no records for this time period </h2>
<%else%>
<h1><%= @user.user.firstname%></h1>
<div class="table-responsive">
<%@startdate.upto(@enddate) do |date|%>
   <h1><%=date%></h1>
   <% date=date.to_date%>
   <% timestart=date.beginning_of_day%>
   <% timeend=date.end_of_day%>

<table class="table table-hover">
  <tr>
    <th class="column_wide">CompanyName</th>
    <th class="column_wide">Job Name</th>       
    <th class="column_wide">Job Number</th>
    <th class="column_wide">Task</th>       
    <th class="column_wide">Date</th>       
    <th class="column_wide">Time In</th>
    <th class="column_wide">Time Out</th>
    <th class="column_wide">Total</th>
  </tr>
<% Timerecord.selecteduser(params[:id]).weekstart(timestart).weekend(timeend).find_each do |t| %>
<%@jobname = Jobnumbers.find_by JobNumber: t.jobnumber%>
 <tr>
    <%if (@jobname == nil)%>
    <td></td>
    <td></td>
    <%else%>
    <%@customername = Contacts.find_by! id: @jobname.contacts_id%>
    <td><%=@customername.CompanyName%></td>
    <td><%=@jobname.projectName%></td>
    <%end%>
    <td><%=link_to t.jobnumber, edit_timerecord_path(t.id) %></td>
    <td><%=t.task.taskname %></td>
    <td><%= t.timein.strftime("%m-%d") %></td>
    <td><%= t.timein.strftime("%I:%M %p") %></td>
    <%if (t.timeout == nil)%>
    <td class="danger"><%= Time.current.strftime("%I:%M %p") %></td>
    <%@timeout = Time.current%>
    <%else%>
    <td><%= t.timeout.strftime("%I:%M %p") %></td>
    <%@timeout = t.timeout%>
    <%end%>
     <% @time_in_mins = ((@timeout - t.timein) / 1.minute).ceil %>
     <% @time_in_hours = ((@timeout - t.timein) / 1.hour).ceil %>
    <td><%=  @time_in_hours-1 %> hours
    <%=  @time_in_mins - (@time_in_mins/60).ceil * 60 %> mins</td>
  </tr>
<% end %>
<%end%>
<tr>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
    <td>
    <% @time_in_mins = ((@timetotal) / 1.minute).ceil %>
    <% @time_in_hours = ((@timetotal) / 1.hour).ceil %>
    <%=  @time_in_hours -1 %> hours
  <%=  @time_in_mins - (@time_in_mins/60).ceil * 60 %> mins  </td>
  </tr>
 
</table>


</div>
<%end%>

<%= form_tag({}, {:method => :get}) do %>

<%=date_field_tag 'startdate', '01/01/2014'%>
<%=date_field_tag 'enddate', '01/01/2014'%>
<button class="btn" type="submit"><i class="icon-search"></i></button>
<% end %>
  
  <%= link_to 'Back', timerecords_admin_path %>


<%end%>

  
    

	

